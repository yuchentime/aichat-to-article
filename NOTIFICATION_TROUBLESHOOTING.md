# 浏览器通知问题排查指南

## 问题描述
浏览器通知功能没有正常工作，需要排查原因。

## 已实施的修复

### 1. 修复通知函数 [`sendNotification`](src/background/index.ts:66-74)
- 添加了完整的错误处理
- 添加了成功/失败日志记录
- 修复了图标路径问题
- 添加了权限检查

### 2. 主要问题分析
1. **缺少错误处理**: 原代码没有处理通知创建失败的情况
2. **图标路径问题**: 原代码中图标路径被注释掉，可能导致通知失败
3. **缺少权限检查**: 没有检查浏览器通知权限状态

### 3. 新增功能
- 添加了 [`testNotification`](src/background/index.ts:325-329) 测试函数
- 添加了消息监听器支持测试命令
- 添加了详细的日志记录

## 测试方法

### 方法1: 使用浏览器控制台测试
在浏览器控制台中运行 [`test-notification.js`](test-notification.js) 中的代码：

```javascript
// 发送测试通知
chrome.runtime.sendMessage({
  type: 'testNotification'
});

// 检查权限
chrome.notifications.getPermissionLevel((level) => {
  console.log('通知权限级别:', level);
});
```

### 方法2: 查看浏览器控制台日志
打开浏览器的扩展服务工作者控制台，查看日志输出：
- 成功通知会显示 "通知发送成功"
- 失败通知会显示 "通知发送失败"
- 权限检查会显示当前权限级别

### 方法3: 检查浏览器设置
1. 确保浏览器允许通知
2. 检查操作系统级别的通知设置
3. 确认扩展有正确的通知权限

## 常见问题排查

### 1. 权限问题
- 检查 `chrome://settings/content/notifications`
- 确保网站和扩展有通知权限

### 2. 图标路径问题
- 图标文件必须存在于构建后的扩展中
- 使用 `chrome.runtime.getURL()` 获取正确路径

### 3. 服务工作者问题
- 确保背景脚本正确加载
- 检查是否有其他错误阻止脚本执行

## 下一步调试
1. 重新加载扩展
2. 在浏览器控制台中运行测试脚本
3. 查看服务工作者控制台的日志输出
4. 根据日志信息进一步排查具体问题

如果通知仍然不工作，请检查：
- 浏览器控制台是否有错误信息
- 扩展的服务工作者是否正常运行
- 操作系统通知设置是否正确